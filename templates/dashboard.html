html
<!-- console log functions -->
                function clearConsoleLog() {
                    const consoleLog = document.getElementById('consoleLog');
                    if (consoleLog) {
                        consoleLog.innerHTML = '<div class="text-muted">Console cleared</div>';
                    }
                }

                function toggleAutoScroll() {
                    autoScroll = !autoScroll;
                    const btn = document.getElementById('autoScrollBtn');
                    if (btn) {
                        btn.innerHTML = autoScroll ?
                            '<i class="fas fa-arrows-alt-v"></i> Auto-scroll: ON' :
                            '<i class="fas fa-arrows-alt-v"></i> Auto-scroll: OFF';
                    }
                }

                // Utility functions
                function formatNumber(number) {
                    // Handle NaN, null, undefined, and infinite values
                    if (number === null || number === undefined || isNaN(number) || !isFinite(number)) {
                        return '0.00';
                    }
                    return new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(number);
                }

                 // Refresh dashboard data
                function updateDashboard() {
                    refreshData();
                }
                 // Show anomalies function
                function showAnomalies() {
                    alert('Anomaly Detection System\n\n' +
                          '• Unusual market movements\n' +
                          '• Unexpected position changes\n' +
                          '• API connection issues\n' +
                          '• Risk management alerts\n\n' +
                          'Check console logs for detailed anomaly reports.');
                }

                function displayInsights(insights) {
                    const container = document.getElementById('insights-content');

                    if (!insights || Object.keys(insights).length === 0) {
                        container.innerHTML = '<div class="text-muted">No insights available yet.</div>';
                        return;
                    }

                    let html = '';
                    for (const [key, value] of Object.entries(insights)) {
                        html += `
                            <div class="insight-item">
                                <span class="insight-label">${key}:</span>
                                <span class="insight-value">${value}</span>
                            </div>
                        `;
                    }
                    container.innerHTML = html;
                }

                function displayPredictions(predictions) {
                    const container = document.getElementById('predictions-content');

                    if (!predictions || predictions.length === 0) {
                        container.innerHTML = '<div class="text-muted">No predictions available yet.</div>';
                        return;
                    }

                    let html = '';
                    predictions.forEach(function(prediction) {
                        const statusClass = prediction.confidence > 0.7 ? 'profitable' : 
                                          prediction.confidence < 0.3 ? 'unprofitable' : 'neutral';

                        html += `
                            <div class="prediction-item">
                                <strong>${prediction.symbol}</strong> - ${prediction.direction}
                                <span class="status ${statusClass}">${(prediction.confidence * 100).toFixed(1)}% confidence</span>
                                <small>${prediction.timeframe}</small>
                            </div>
                        `;
                    });
                    container.innerHTML = html;
                }

                function showSuccess(containerId, message) {
                    const container = document.getElementById(containerId);
                    const existingContent = container.innerHTML;
                    container.innerHTML = `<div class="success">✅ ${message}</div><br>${existingContent}`;

                    // Remove success message after 5 seconds
                    setTimeout(() => {
                        container.innerHTML = existingContent;
                    }, 5000);
                }

                // Safety validation feedback function
                function handleSafetyValidation(data) {
                    if (data && data.safety_warnings && data.safety_warnings.length > 0) {
                        let warningMessage = '⚠️ Safety corrections were applied:\n\n';
                        data.safety_warnings.forEach(function(warning) {
                            warningMessage += '• ' + warning + '\n';
                        });
                        warningMessage += '\nConfiguration was saved with safe default values.';

                        // Show as a warning alert instead of blocking alert
                        showAlert(warningMessage, 'warning');
                    }
                }

                // Alert function
                function showAlert(message, type) {
                    const alertDiv = document.createElement('div');
                    alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
                    alertDiv.innerHTML = `
                        ${message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    `;

                    const container = document.querySelector('.container-fluid'); // Or any specific container you want to insert into
                    container.prepend(alertDiv);

                    // Automatically close the alert after 5 seconds
                    setTimeout(() => {
                        alertDiv.remove();
                    }, 5000);
                }

                // Include MACD threshold fields in form data collection
                // Include MACD threshold fields in form data collection
                function collectFormData(strategyName) {
                    const formData = {};

                    formData.symbol = document.getElementById('strategySymbol').value;
                    formData.margin = parseFloat(document.getElementById('strategyMargin').value);
                    formData.leverage = parseInt(document.getElementById('strategyLeverage').value);
                    formData.decimals = parseInt(document.getElementById('strategyDecimals').value);
                    formData.timeframe = document.getElementById('strategyTimeframe').value;
                    formData.max_loss_pct = parseFloat(document.getElementById('strategyMaxLoss').value);
                    formData.assessment_interval = parseInt(document.getElementById('assessmentInterval').value);
                    formData.cooldown_period = parseInt(document.getElementById('cooldownPeriod').value);

                    // Partial Take Profit Configuration
                    formData.partialTpEnabled = document.getElementById('partialTpEnabled').checked;

                    if (formData.partialTpEnabled) {
                        const threshold = document.getElementById('partialTpPnlThreshold').value;
                        const positionSize = document.getElementById('partialTpPositionPercentage').value;

                        if (threshold && positionSize) {
                            formData.partial_tp_pnl_threshold = parseFloat(threshold);
                            formData.partial_tp_position_percentage = parseFloat(positionSize);
                        }
                    }

                    if (strategyName.toLowerCase().includes('rsi')) {
                        formData.rsi_long_entry = parseInt(document.getElementById('rsiLongEntry').value);
                        formData.rsi_long_exit = parseInt(document.getElementById('rsiLongExit').value);
                        formData.rsi_short_entry = parseInt(document.getElementById('rsiShortEntry').value);
                        formData.rsi_short_exit = parseInt(document.getElementById('rsiShortExit').value);
                    }

                    if (strategyName.toLowerCase().includes('macd')) {
                        formData.macd_fast = parseInt(document.getElementById('macdFast').value);
                        formData.macd_slow = parseInt(document.getElementById('macdSlow').value);
                        formData.macd_signal = parseInt(document.getElementById('macdSignal').value);
                        formData.min_histogram_threshold = parseFloat(document.getElementById('minHistogramThreshold').value);
                        formData.macd_entry_threshold = parseFloat(document.getElementById('macdEntryThreshold').value);
                        formData.macd_exit_threshold = parseFloat(document.getElementById('macdExitThreshold').value);
                        formData.histogram_divergence_lookback = parseInt(document.getElementById('histogramDivergenceLookback').value);
                        formData.price_divergence_lookback = parseInt(document.getElementById('priceDivergenceLookback').value);
                        formData.confirmation_candles = parseInt(document.getElementById('confirmationCandles').value);
                        formData.divergence_strength_min = parseFloat(document.getElementById('divergenceStrengthMin').value);
                    }

                    return formData;
                }

                // Show safety validation feedback in alert
                function handleSafetyValidation(data) {
                    if (data && data.safety_warnings && data.safety_warnings.length > 0) {
                        let warningMessage = '⚠️ Safety corrections were applied:\n\n';
                        data.safety_warnings.forEach(function(warning) {
                            warningMessage += '• ' + warning + '\n';
                        });
                        warningMessage += '\nConfiguration was saved with safe default values.';

                        // Show the safety warning as an alert on the page
                        showAlert(warningMessage, 'warning');
                    }
                }

                function syncDatabase() {
                    fetch('/api/sync_database', {
                        method: 'POST'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            showAlert('success', data.message);
                            loadTrades();
                        } else {
                            showAlert('danger', 'Sync failed: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showAlert('danger', 'Sync request failed');
                    });
                }

                function syncSharedDatabase() {
                    fetch('/api/sync_shared_database', {
                        method: 'POST'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            showAlert('success', data.message);
                            loadTrades();
                            loadSharedDatabaseStatus();
                        } else {
                            showAlert('danger', 'Shared sync failed: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showAlert('danger', 'Shared sync request failed');
                    });
                }

                function loadSharedDatabaseStatus() {
                    fetch('/api/shared_database_status')
                    .then(response => response.json())
                    .then(data => {
                        const statusElement = document.getElementById('sharedDbStatusText');
                        if (data.status === 'connected') {
                            statusElement.innerHTML = `Connected - ${data.total_trades} trades (${data.open_trades} open, ${data.closed_trades} closed)`;
                            document.getElementById('sharedDbStatus').className = 'alert alert-success';
                        } else {
                            statusElement.innerHTML = `${data.status} - ${data.message || 'Unknown error'}`;
                            document.getElementById('sharedDbStatus').className = 'alert alert-warning';
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById('sharedDbStatusText').innerHTML = 'Error loading status';
                        document.getElementById('sharedDbStatus').className = 'alert alert-danger';
                    });
                }
            </script>
            </body>
            </html>